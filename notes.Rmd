---
title: "Notebook: Analisis Tingkat Risiko Kesehatan Mahasiswa"
author: "Muhammad Hidayat"
date: "`r Sys.Date()`"
output: 
  html_notebook: 
    toc: true
---

# Pendahuluan

# Persiapan

## Memuat library

```{r setup, message = FALSE, warning = FALSE}
library(dplyr)
library(ggplot2)
library(tidyverse)
library(tidyr)
library(moments) # untuk skewness dan kurtosis
library(car) # untuk analisis statistik
library(nortest) # untuk uji normalitas
library(ggpubr) # untuk visualisasi statistik
```

## Memuat data

Dataset yang digunakan adalah [Student Health and Attendance Data](https://www.kaggle.com/datasets/ziya07/student-health-and-attendance-data). Berikut perintah `bash` untuk mengecek kesamaan file.

```{bash checksum}
sha256sum "Student Health and Attendance Data/"*
```

Kedua file sama, jadi cukup satu yang digunakan, yaitu `student_monnitoring_data.csv`.

```{r read.csv}
data <- read.csv("Student Health and Attendance Data/student_monnitoring_data.csv")
```

```{r sum.is.na}
sum(is.na(data))
```

Tidak ada data kosong dalam dataset, sehingga tidak perlu dibersihkan.

Berikut 10 data pertama dan 10 data terakhir dari dataset.

```{r data.head}
data |> head(10)
```

```{r data.tail}
data |> tail(10)
```

```{r data.summary}
data |> summary()
```

## Transformasi data

Selanjutnya, data di atas diproses dengan mengubah tipe data:

- Date (Date)
- Class.Time &rarr; Start.Time (POSIXct), End.Time (POSIXct)
- Attendance.Status &rarr; (Factor)
- Risk.Level &rarr; (Factor)

Selain itu, terdapat data yang ditambahkan:

- Class.Duration.Hours (Numeric), jeda waktu antara Start.Time dan End.Time dalam satuan jam. Operasi pengurangan dengan data tersebut sebenarnya memanggil fungsi "difftime" dan secara bawaan menghasilkan keluaran dalam satuan jam.

```{r mutate}
new_data <- data |>
  mutate(
    Date = Date |> as.Date(format = "%Y-%m-%d"),
    Start.Time = Class.Time |> as.character() |> strsplit("-") |> sapply(\(x) x[1]),
    End.Time = Class.Time |> as.character() |> strsplit("-") |> sapply(\(x) x[2]),
    Start.Time = paste(Date, Start.Time) |> as.POSIXct(format = "%Y-%m-%d %H:%M"),
    End.Time = paste(Date, End.Time) |> as.POSIXct(format = "%Y-%m-%d %H:%M"),
    Start.Hour = as.numeric(format(Start.Time, "%H")),
    End.Hour = as.numeric(format(End.Time, "%H")),
    Class.Duration = (End.Time - Start.Time) |> as.numeric(),
    Stress.Level..GSR. = Stress.Level..GSR. |> as.numeric(),
    Sleep.Hours = Sleep.Hours |> as.numeric(),
    Anxiety.Level = Anxiety.Level |> as.numeric(),
    Mood.Score = Mood.Score |> as.numeric(),
    Attendance.Status = Attendance.Status |> as.factor(),
    Risk.Level = Risk.Level |> as.factor()
  )
```

Berikut penjelasan dari perubahan di atas:

- "Attendance Status" dan "Risk Level" diubah menjadi tipe Factor karena merupakan data kualitatif/kategorik.
- "Date" diubah menjadi tipe Date karena merupakan data tanggal.
- "Class Time" dipecah menjadi dua, yaitu "Start Time" dan "End Time". Data Character dari "Class Time" mula-mula dipecah menjadi dua pada tanda "-" menggunakan fungsi "strsplit()" sehingga "9:00-15:00" berubah menjadi `r strsplit("9:00-15:00", "-") |> paste()`. Masing-masing kemudian digabung dengan Character dari Date sehingga membentuk format "2024-12-01 9:00" yang nantinya dikonversi menjadi tipe waktu POSIXct.
- Data yang lain diubah ke tipe Numeric karena sudah berupa bilangan.
- Proses transformasi data menggunakan sintaks baru untuk piping, yaitu `|>`, yang dikenalkan sejak R versi 4.1.

Berikut 10 data pertama dan 10 data terakhir dari dataset yang diubah.

```{r new_data.head}
new_data |> head(10)
```

```{r new_data.tail}
new_data |> tail(10)
```

```{r new_data.summary}
new_data |> summary()
```

# Eksplorasi Data

## Banyak mahasiswa per hari berdasarkan kehadiran

```{r students.per.day}
students.per.day <-
  new_data |>
  select(Student.ID, Date, Attendance.Status) |>
  group_by(Date, Attendance.Status) |>
  summarise(Count = n(), .groups = "drop") |>
  pivot_wider(names_from = Attendance.Status, values_from = Count, values_fill = 0) |>
  (\(df) mutate(df, Total = rowSums(select(df, -Date), na.rm = TRUE)))()

students.per.day
```


```{r students.per.day.plot}
# Assume 'attendance_summary' is your summary data frame
# First, reshape the data to a long format
students.per.day.long <- students.per.day |>
  pivot_longer(
    cols = -c(Date, Total),
    names_to = "Attendance.Status",
    values_to = "Count"
  )

# Create a stacked bar plot
students.per.day.plot <- ggplot(students.per.day.long, aes(x = Date, y = Count, fill = Attendance.Status)) +
  geom_bar(stat = "identity") + # Use identity to avoid counting
  labs(
    title = "Attendance by Date",
    x = "Date",
    y = "Number of Students",
    fill = "Attendance Status"
  ) +
  theme_minimal() + # Use a clean theme
  scale_fill_brewer(palette = "Set1") # Optional: Chooses a color palette

# Display the plot
print(students.per.day.plot)
```

```{r students.per.day.summary}
students.per.day.long |> select(-Date, -Total) |> group_by(Attendance.Status) |>
  summarise(
    mean = mean(Count),
    median = median(Count),
    stdev = sd(Count),
    min = min(Count),
    range = max(Count) - min(Count),
    max = max(Count),
    skew = skewness(Count),
    kurt = kurtosis(Count)
  )
```

Tingkat kehadiran, keterlambatan, dan absen relatif imbang

## Tingkat kehadiran mahasiswa berdasarkan tingkat risiko kesehatan 

```{r attendance.by.risk}
attendance.by.risk <-
  new_data |>
  select(Student.ID, Risk.Level, Attendance.Status) |>
  group_by(Risk.Level, Attendance.Status) |>
  summarise(Count = n(), .groups = "drop")

attendance.by.risk.wide <- attendance.by.risk |> pivot_wider(names_from = Risk.Level, values_from = Count, values_fill = 0)

attendance.by.risk.wide
```

```{r attendance.by.risk.plot}
attendance.by.risk.plot <- attendance.by.risk |>
  ggplot(aes(x = Risk.Level, y = Count, fill = Attendance.Status)) +
  geom_bar(stat = "identity", position = position_dodge2(preserve = "single")) + # Use identity to avoid counting
  labs(
    title = "Attendance by Risk",
    x = "Risk Level",
    y = "Number of Students",
    fill = "Attendance Status",
  ) +
  theme_minimal() + # Use a clean theme
  scale_fill_brewer(palette = "Set1") # Optional: Chooses a color palette

# Display the plot
print(attendance.by.risk.plot)
```

Grafik di atas menunjukkan tingkat risiko kesehatan tinggi jika mahasiswa tidak hadir pada kuliah hari itu.

## Faktor-faktor yang mempengaruhi tingkat risiko kesehatan

```{r}
ggplot(new_data, aes(x = Risk.Level, y = Class.Duration, fill = Risk.Level)) +
  geom_boxplot() +
  labs(title = "Class Duration by Risk Level")
```

```{r}
ggplot(new_data, aes(x = Risk.Level, y = Sleep.Hours, fill = Risk.Level)) +
  geom_boxplot() +
  labs(title = "Sleep Hours by Risk Level")
```

```{r}
ggplot(new_data, aes(x = Risk.Level, y = Stress.Level..GSR., fill = Risk.Level)) +
  geom_boxplot() +
  labs(title = "Stress Level (GSR) by Risk Level")
```

```{r}
ggplot(new_data, aes(x = Risk.Level, y = Anxiety.Level, fill = Risk.Level)) +
  geom_boxplot() +
  labs(title = "Anxiety Level by Risk Level")
```

```{r}
ggplot(new_data, aes(x = Risk.Level, y = Mood.Score, fill = Risk.Level)) +
  geom_boxplot() +
  labs(title = "Mood Score by Risk Level")
```

```{r}
ggplot(new_data, aes(x = Risk.Level, y = Start.Hour, fill = Risk.Level)) +
  geom_boxplot() +
  labs(title = "Class Start Time by Risk Level")
```

```{r}
ggplot(new_data, aes(x = Risk.Level, y = End.Hour, fill = Risk.Level)) +
  geom_boxplot() +
  labs(title = "Class End Time by Risk Level")
```

Lama kuliah per hari dan lama tidur tidak memiliki pengaruh signifikan terhadap tingkat risiko kesehatan. Tetapi, tingkat stress sangat mempengaruhi hasilnya.

Untuk tingkat _anxiety_ dan _mood_, hasilnya sedikit membingungkan. Tingkat risiko medium memiliki tingkat _anxiety_ tertinggi dan _mood_ terendah dari ketiga kategori risiko. Sementara itu, tingkat risiko rendah berada di posisi bawah dan atas berturut-turut dan tinggi berada di tengah-tengah.


## [OMIT] Korelasi antara durasi jam kuliah dan durasi jam tidur

```{r desc_class.duration_sleep.hours}
# Assuming your data frame is called 'new_data'
# Basic descriptive statistics
desc_stats <- new_data |>
  summarize(
    Mean_Class_Duration = mean(Class.Duration, na.rm = TRUE),
    Median_Class_Duration = median(Class.Duration, na.rm = TRUE),
    SD_Class_Duration = sd(Class.Duration, na.rm = TRUE),
    Range_Class_Duration = range(Class.Duration, na.rm = TRUE),

    Mean_Sleep_Hours = mean(Sleep.Hours, na.rm = TRUE),
    Median_Sleep_Hours = median(Sleep.Hours, na.rm = TRUE),
    SD_Sleep_Hours = sd(Sleep.Hours, na.rm = TRUE),
    Range_Sleep_Hours = range(Sleep.Hours, na.rm = TRUE)
  )

print(desc_stats)
```

```{r corr}
# Correlation between Class.Duration and Sleep.Hours
correlation <- cor(new_data$Class.Duration, new_data$Sleep.Hours, use = "complete.obs")
print(paste("Correlation coefficient between Class Duration and Sleep Hours:", correlation))
```


```{r hist_class_duration}
# Create a histogram for Class.Duration
hist_class_duration <- ggplot(new_data, aes(x = Class.Duration)) +
  geom_histogram(binwidth = 0.5, fill = "blue", color = "black", alpha = 0.7) + # Specify the bin width and colors
  labs(
    title = "Histogram of Class Duration",
    x = "Class Duration (Hours)",
    y = "Frequency"
  ) +
  theme_minimal()  # Use a clean theme

# Print the histogram for Class Duration
print(hist_class_duration)
```

```{r hist_sleep_hours}
# Create a histogram for Sleep.Hours
hist_sleep_hours <- ggplot(new_data, aes(x = Sleep.Hours)) +
  geom_histogram(binwidth = 0.1, fill = "green", color = "black", alpha = 0.7) + # Specify the bin width and colors
  labs(
    title = "Histogram of Sleep Hours",
    x = "Sleep Hours",
    y = "Frequency"
  ) +
  theme_minimal()  # Use a clean theme

# Print the histogram for Sleep Hours
print(hist_sleep_hours)
```

```{r boxplot_class.duration_sleep.hours}
# Boxplot for Class Duration
boxplot(new_data$Class.Duration, main="Boxplot of Class Duration", ylab = "Class Duration (Hours)")

# Boxplot for Sleep Hours
boxplot(new_data$Sleep.Hours, main="Boxplot of Sleep Hours", ylab = "Sleep Hours")
```


```{r class.and.sleep}
class.and.sleep <- new_data |>
  select(Class.Duration, Sleep.Hours, Risk.Level) |>
  group_by(Class.Duration, Sleep.Hours, Risk.Level) |>
  summarise(Count = n(), .groups = "keep") |>
  pivot_wider(names_from = Risk.Level, values_from = Count, values_fill = 0)
  
show(class.and.sleep)
```


```{r class.and.sleep.plot}
class.and.sleep.long <- class.and.sleep |>
  pivot_longer(cols = -c(Class.Duration, Sleep.Hours), names_to = "Risk.Level", values_to = "Count")

class.and.sleep.plot <- class.and.sleep.long |>
  ggplot(aes(y = Class.Duration, x = Sleep.Hours)) +
  geom_point(aes(size = Count, color = Risk.Level), alpha = 0.6) +
  scale_size(range = c(1, 10), name = "Count of Students") +  # Adjust the range for bubble sizes
  labs(
    title = "Bubble Plot of Class Duration and Sleep Hours",
    y = "Class Duration (Hours)",
    x = "Sleep Hours",
    color = "Risk Level"
  ) +
  theme_minimal() +  # Use a clean theme
  scale_color_brewer(palette = "Set1") + # Optional: Choose a color palette
  facet_wrap(~Risk.Level) # Create a separate plot for each risk level

show(class.and.sleep.plot)
```

```{r risk.by.class.duration}
risk.by.class.duration <- new_data |>
  select(Class.Duration, Risk.Level) |>
  count(Class.Duration, Risk.Level)

show(risk.by.class.duration)
```

```{r risk.by.class.duration.plot}
risk.by.class.duration.plot <- risk.by.class.duration |>
  ggplot(aes(x = Class.Duration, y = n, fill = Risk.Level)) +
  geom_bar(stat = "identity", position = position_dodge2(preserve = "single")) + # Use identity to avoid counting
  labs(
    title = "Risk by Class Duration",
    x = "Class Duration",
    y = "Number of Students",
    fill = "Risk Level",
  ) +
  scale_x_continuous(breaks = seq(1, 8)) +
  scale_y_continuous(breaks = seq(0, 2000, by = 200)) +
  theme_minimal() + # Use a clean theme
  scale_fill_brewer(palette = "Set1") # Optional: Chooses a color palette

# Display the plot
print(risk.by.class.duration.plot)
```


```{r risk.by.sleep.hours}
risk.by.sleep.hours <- new_data |>
  select(Sleep.Hours, Risk.Level) |>
  count(Sleep.Hours, Risk.Level)

show(risk.by.sleep.hours)
```

```{r risk.by.sleep.hours.plot}
risk.by.sleep.hours.plot <- risk.by.sleep.hours |>
  ggplot(aes(x = Sleep.Hours, y = n, fill = Risk.Level)) +
  geom_bar(stat = "identity", position = position_dodge2(preserve = "single")) + # Use identity to avoid counting
  labs(
    title = "Risk by Class Duration",
    x = "Sleep Hours",
    y = "Number of Students",
    fill = "Risk Level",
  ) +
  scale_x_continuous(breaks = seq(5, 10)) +
  scale_y_continuous(breaks = seq(0, 300, by = 30)) +
  theme_minimal() + # Use a clean theme
  scale_fill_brewer(palette = "Set1") # Optional: Chooses a color palette

# Display the plot
print(risk.by.sleep.hours.plot)
```

<!--
Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Ctrl+Alt+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Ctrl+Shift+K* to preview the HTML file).

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.
-->

# Membuat Model

