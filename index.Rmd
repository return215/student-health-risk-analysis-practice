---
title: "Analisis Komparatif Model Pembelajaran Mesin Untuk Klasifikasi Kesehatan dan Kehadiran Mahasiswa"
author: "Muhammad Hidayat"
date: "`r Sys.Date()`"
bibliography: [bibliography.bib, packages.bib]
nocite: '@*'
csl: apa-no-initials.csl
output: 
  bookdown::pdf_document2: default
  bookdown::html_document2: 
    download:
      - ["index.pdf", "PDF"]
    toc_depth: 2
    keep_md: true
  github_document: 
    toc: true
    toc_depth: 2
    number_sections: true
  pdf_document: 
    toc: true
    toc_depth: 2
    number_sections: true
    latex_engine: xelatex
    keep_tex: true
    highlight: pygments
  html_document:
    toc: true
    toc_depth: 2
    fig_width: 8
    fig_height: 6
    number_sections: true
    keep_md: true
  word_document: 
    toc: true
    toc_depth: 2
    keep_md: true
  html_notebook: 
    toc: true
    toc_depth: 2
    number_sections: true
---

```{r setup, include=FALSE}
# --- Import libraries

# Comprehensive Collection of Packages
library(tidyverse)   # Collection of R packages for data science (includes ggplot2, dplyr, tidyr, etc.)

# Statistical Analysis and Tests
library(Hmisc)       # Harrell's miscellaneous library, includes advanced statistical functions
library(moments)     # Moments, skewness, kurtosis computations
library(car)         # Companion to applied regression, diagnostics
library(nortest)     # Normality tests

# Data Manipulation and Transformation
library(dplyr)       # Data manipulation and pipeline operations
library(tidyr)       # Data tidying and reshaping (e.g., pivot_longer)
library(purrr)       # Functional programming tools (e.g., map functions)
library(insight)     # Understanding and managing model insights

# Plotting and Visualization
library(ggplot2)     # Data visualization and plotting
library(ggpubr)      # Publication-ready plots (enhancements to ggplot2)
library(corrplot)    # Visualization for correlation matrices

# Table Formatting
library(xtable)      # Export tables to LaTeX or HTML
library(kableExtra)  # Enhancements for 'knitr' tables

# Machine Learning and Modeling
library(caret)       # ML models and utility functions
library(nnet)        # Neural networks and multinom for multinomial regression
library(randomForest)# Random forest algorithms
library(e1071)       # SVMs and other utilities

# --- Set the figure options

# Set figure size (in inches) and position
knitr::opts_chunk$set(
  fig.width = 7,
  fig.height = 3.5,
  fig.align = "center"
)

# Set ggplot2 default theme
theme_set(theme_minimal())

# Make tables render properly
options(knitr.kable.NA = "")

knitr::write_bib(file = 'packages.bib')
```

# Abstrak {#abstract -}

lorem

# Pendahuluan {#intro}

(ref:ai-illustration-caption) Ilustrasi berjudul "Random Forest Logistics on Support Vector" yang dibuat oleh AI menggunakan [PixAI](https://pixai.art/artwork/1851317707578583462?utm_source=copy_web)

```{r ai-illustration, fig.cap="(ref:ai-illustration-caption)", fig.width=4, fig.height=4, echo=FALSE}
knitr::include_graphics("illustration-ai.png")
```

Dalam perkuliahan, kesehatan mahasiswa harus dijaga untuk pembelajaran optimal. Menurut penelitian dari Pratama and Nur Zaimah [-@pratama_2024_pengaruh], melakukan aktivitas fisik dapat mengurangi tingkat kecemasan, depresi, serta meningkatkan suasana hati dan fungsi kognitif. Selain kesehatan fisik, kesehatan mental juga perlu diperhatikan dikarenakan kontribusinya terhadap perkembangan dan kesuksesan pola pikir mahasiswa yang bukan hanya berpengaruh secara individual, namun juga dalam kelompok.

Analisis terhadap data kesehatan mampu mendeteksi pola keseharian mahasiswa melalui berbagai faktor dan dapat menentukan tingkat risiko kesehatan mereka. Proses pengambilan keputusan berbasis data dapat menjadi acuan institusi pendidikan untuk meningkatkan kesejahteraan peserta didiknya.

Dengan perkembangan teknologi yang begitu pesat akhir-akhir ini, kecerdasan buatan telah melampaui batas yang semula sulit diraih. Dari membuat makalah lengkap yang terstruktur hingga gambar yang menyerupai lukisan, seperti contoh gambar pada Figure \@ref(fig:ai-illustration), kecerdasan buatan telah menjadi alat untuk membantu manusia mencapai tujuannya. Semua ini berawal dari data yang dipilih dan diolah, yang kemudian dijadikan bahan latihan untuk komputer agar mampu mengambil keputusan yang tepat. Inilah inti dari pembelajaran mesin, atau disebut _machine learning_.

Penggunaan teknik dan model pembelajaran mesin terhadap data kesehatan mahasiswa diharapkan dapat membantu mengidentifikasi tanda-tanda risiko pada masing-masing individu. Pembelajaran mesin terutama bermanfaat untuk mengenali pola pada data dengan banyak variabel dengan beragam karakteristik, baik linear, polinomial, eksponensial, maupun fluktuatif. Hasil pengenalan ini nantinya membentuk suatu model yang akan digunakan untuk memprediksi kasus-kasus baru yang belum pernah ditemui sebelumnya. Dengan informasi baru yang didapat, intervensi maupun pencegahan dapat dilakukan oleh pihak terkait.

Tujuan dari laporan ini adalah sebagai latihan penulis dalam mengeksplorasi data, memprosesnya sebagai bahan untuk pembelajaran mesin, dan menentukan algoritma dan parameter yang tepat untuk melatih mesin agar mampu memprediksi hasil dengan akurat dan efisien. Semua tahapan ini dijalankan menggunakan bahasa pemrograman R.

Laporan ini terbagi menjadi beberapa bagian, selain dari bagian ini. [Bagian 2](#data) akan membahas tentang data yang digunakan, pengolahan data untuk eksplorasi data, dan pengolahan data untuk pembelajaran mesin. [Bagian 3](#machine-learn) akan membahas tentang model pembelajaran mesin yang digunakan, parameter yang ditetapkan, serta langkah evaluasi model. [Bagian 4](#results) akan membahas tentang performa model dan menetapkan model terbaik. [Bagian 5](#conclusion) berisikan kesimpulan dari hasil temuan, keterbatasan, serta saran untuk penelitian ke depannya.

# Eksplorasi dan Pengolahan Data {#data}

Dalam laporan ini, penulis mengacu pada dataset kesehatan dan kehadiran mahasiswa yang disediakan oleh Ziya [-@ziya_2024_student].

## Memuat data

Dataset disediakan dalam bentuk file CSV, dan proses membaca file dapat dilakukan dengan mudah. Dalam dataset tersebut, terdapat dua file CSV yang identik. Berikut perintah `bash` untuk mengecek kesamaan file.

```{bash checksum}
cd "Student Health and Attendance Data/"
sha1sum *
```

Kedua file sama, jadi cukup satu yang digunakan, yaitu `student_monnitoring_data.csv`.

```{r read-csv}
data <- read.csv("Student Health and Attendance Data/student_monnitoring_data.csv")
```

Lihat Tabel \@ref(tab:data-head) untuk 10 data pertama dan Tabel \@ref(tab:data-tail) untuk 10 data terakhir dari dataset.

```{r data-head, echo=FALSE}
data |>
  head(10) |>
  kbl(
    caption = "Data awal (10 pertama)",
  ) |>
  kable_material()
```

```{r data-tail, echo=FALSE}
data |>
  tail(10) |>
  kbl(
    caption = "Data awal (10 terakhir)",
  ) |>
  kable_material()
```

Tabel \@ref(tab:data-summary) dan \@ref(tab:data-summary-2) memberikan gambaran bentuk data apa adanya dari file CSV.

```{r data-summary, echo=FALSE}
# TODO fix table
data |>
  select(Student.ID, Stress.Level..GSR., Sleep.Hours, Anxiety.Level, Mood.Score) |>
  summary() |>
  kbl(
    caption = "Ringkasan data awal (1)",
    digits = 2,
  ) |>
  kable_material()
```

```{r data-summary-2, echo=FALSE}
# TODO fix table
data |>
  select(Date, Class.Time, Attendance.Status, Risk.Level) |>
  summary() |>
  kbl(
    caption = "Ringkasan data awal (2)",
    digits = 2,
  ) |>
  kable_material()
```

Langkah selanjutnya adalah memastikan tidak ada baris kosong dalam dataset. Banyak baris kosong dapat diketahui dengan perintah berikut:

```{r sum-is-na}
sum(is.na(data))
```

Tidak ada data kosong dalam dataset, sehingga tidak perlu dibersihkan.

## Transformasi data

Untuk mempermudah eksplorasi dan pengolahan data lebih lanjut, data di atas diproses dengan mengubah tipe data:

- Date (Date)
- Class.Time &rarr; Start.Time (POSIXct), End.Time (POSIXct) "POSIX C Time". Kolom Class.Time akan dihapus karena tidak akan digunakan lagi kedepannya.
- Attendance.Status &rarr; (Factor), dengan ketentuan nilai \(\text{AttendanceStatus} \rightarrow \{1(\text{Present}), 2(\text{Late}), 3(\text{Absent})\}\).
- Risk.Level &rarr; (Factor), dengan ketentuan nilai \(\text{RiskLevel} \rightarrow \{1(\text{Low}), 2(\text{Medium}), 3(\text{High})\}\).

Selain itu, terdapat data yang ditambahkan:

- Class.Duration (Numeric), jeda waktu antara Start.Time dan End.Time dalam satuan jam. Operasi pengurangan dengan data tersebut sebenarnya memanggil fungsi "difftime" dan secara bawaan menghasilkan keluaran dalam satuan jam.
- Start.Hour dan End.Hour (Numeric), waktu mulai dan selesai kelas mahasiswa dalam satuan jam.

```{r mutate}
new_data <- data |>
  mutate(
    Student.ID = Student.ID |> as.integer(),
    Date = Date |> as.Date(format = "%Y-%m-%d"),
    Start.Time = Class.Time |> as.character() |> strsplit("-") |> sapply(\(x) x[1]),
    Start.Time = paste(Date, Start.Time) |> as.POSIXct(format = "%Y-%m-%d %H:%M"),
    Start.Hour = Start.Time |> format("%H") |> as.numeric(),
    End.Time = Class.Time |> as.character() |> strsplit("-") |> sapply(\(x) x[2]),
    End.Time = paste(Date, End.Time) |> as.POSIXct(format = "%Y-%m-%d %H:%M"),
    End.Hour = End.Time |> format("%H") |> as.numeric(),
    Class.Duration = (End.Time - Start.Time) |> as.numeric(),
    Stress.Level..GSR. = Stress.Level..GSR. |> as.numeric(),
    Sleep.Hours = Sleep.Hours |> as.numeric(),
    Anxiety.Level = Anxiety.Level |> as.numeric(),
    Mood.Score = Mood.Score |> as.numeric(),
    Attendance.Status = Attendance.Status |> as.factor() |> recode_factor(
      "1" = "Present",
      "2" = "Late",
      "3" = "Absent"
    ),
    Risk.Level = Risk.Level |> as.factor() |> recode_factor(
      "1" = "Low",
      "2" = "Medium",
      "3" = "High"
    ),
    .keep = "none"
  )
```

Berikut penjelasan dari perubahan di atas:

- "Attendance Status" dan "Risk Level" diubah menjadi tipe Factor karena merupakan data kualitatif/kategorik bertingkat. Tingkatan diatur sebagaimana di atas.
- "Date" diubah menjadi tipe Date karena merupakan data tanggal.
- "Class Time" dipecah menjadi dua, yaitu "Start Time" dan "End Time". Data Character dari "Class Time" mula-mula dipecah menjadi dua pada tanda "-" menggunakan fungsi "strsplit()" sehingga "9:00-15:00" berubah menjadi `r knitr::combine_words(strsplit("9:00-15:00", "-"), and = "dan")`. Masing-masing kemudian digabung dengan Character dari Date sehingga membentuk format "2024-12-01 9:00" yang nantinya dikonversi menjadi tipe waktu POSIXct.
- "Start Hour" dan "End Hour" mengambil jam dari "Start Time" dan "End Time" berturut-turut.
- Data yang lain diubah ke tipe Numeric karena sudah berupa bilangan.
- Proses transformasi data menggunakan sintaks baru untuk piping, yaitu `|>`, yang dikenalkan sejak R versi 4.1.

Berikut Tabel \@ref(tab:new-data-head) untuk 10 data pertama dan Tabel \@ref(tab:new-data-tail) untuk 10 data terakhir dari dataset yang diubah. Hanya kolom tertentu yang ditampilkan karena keterbatasan ruang.

```{r new-data-head, echo=FALSE}
new_data |>
  select(Student.ID, Start.Time, Start.Hour, End.Time, End.Hour,  Class.Duration, Attendance.Status, Risk.Level) |>
  head(10) |>
  kbl(
    caption = "Data yang diubah (10 pertama)",
  ) |>
  kable_material()
```

```{r new-data-tail, echo=FALSE}
new_data |>
  select(Student.ID, Start.Time, Start.Hour, End.Time, End.Hour,  Class.Duration, Attendance.Status, Risk.Level) |>
  tail(10) |>
  kbl(
    caption = "Data yang diubah (10 terakhir)",
  ) |>
  kable_material()
```

Tabel \@ref(tab:new-data-summary) dan \@ref(tab:new-data-summary-2) memberikan gambaran bentuk data setelah diolah.

```{r new-data-summary, echo=FALSE}
# TODO fix table
new_data |>
  select(Student.ID, Date, Start.Time, Start.Hour, End.Time, End.Hour) |>
  summary() |>
  kbl(
    caption = "Ringkasan data yang diubah (1)",
    digits = 2,
    # col.names = c(
    #   "SID", "Date", "Start Time", "(h)"
    # )
  ) |>
  kable_material()
```

```{r new-data-summary-2, echo=FALSE}
# TODO fix table
new_data |>
  select(Class.Duration, Stress.Level..GSR., Sleep.Hours, Anxiety.Level, Mood.Score, Attendance.Status, Risk.Level) |>
  summary() |>
  kbl(
    caption = "Ringkasan data yang diubah (2)",
    digits = 2,
    # col.names = c(
    #   "End Time", "(h)", "Att. Status", "Risk Level"
    # )
  ) |>
  kable_material()
```

## Eksplorasi Data

Sebelum menerapkan metodologi berikutnya, ada baiknya suatu data dipahami terlebih dahulu melalui proses eksplorasi data. Eksplorasi data bertujuan untuk memahami data dengan lebih baik sebelum diproses dalam tahapan analisis lebih lanjut [@ramdani_2024_pengantar]. Dalam sains data, tahapan ini juga dikenal sebagai _Exploratory Data Analysis_ (EDA), yaitu seperangkat alat yang digunakan untuk memahami sifat, struktur, dan distribusi data, serta melihat hubungan antara beberapa atribut dalam dataset.

Terdapat beberapa hal yang ingin penulis ketahui dalam data ini, di antaranya:

- Berapa banyak mahasiswa yang hadir, terlambat, maupun tidak hadir dalam satu hari perkuliahan?
- Bagaimana hubungan antara kehadiran mahasiswa dengan tingkat risiko kesehatan?
- Bagaimana persebaran dan korelasi dari atribut numerik terhadap tingkat risiko kesehatan?

### Banyak mahasiswa per hari berdasarkan kehadiran

```{r students-per-day, echo=FALSE}
students.per.day <-
  new_data |>
  select(Student.ID, Date, Attendance.Status) |>
  group_by(Date, Attendance.Status) |>
  summarise(Count = n(), .groups = "drop") |>
  pivot_wider(names_from = Attendance.Status, values_from = Count, values_fill = 0) |>
  (\(df) mutate(df, Total = rowSums(select(df, -Date), na.rm = TRUE)))()

students.per.day |>
  head(n = 5) |>
  kbl(
    caption = "Kehadiran per hari (5 hari pertama)",
    digits = 2,
  ) |>
  kable_material()
```

```{r students-per-day-plot, echo=FALSE, fig.cap="Grafik Kehadiran Per Hari"}
# Assume 'attendance_summary' is your summary data frame
# First, reshape the data to a long format
students.per.day.long <- students.per.day |>
  pivot_longer(
    cols = -c(Date, Total),
    names_to = "Attendance.Status",
    values_to = "Count"
  )

# Create a stacked bar plot
students.per.day.plot <- ggplot(
  students.per.day.long, aes(
    x = Date, y = Count, fill = Attendance.Status
  )
) +
  geom_bar(stat = "identity") + # Use identity to avoid counting
  labs(
    title = "Kehadiran per Hari",
    x = "Tanggal",
    y = "Banyak Mahasiswa",
    fill = "Status Kehadiran"
  ) +
  scale_fill_brewer(palette = "Set1") # Optional: Chooses a color palette

# Display the plot
print(students.per.day.plot)
```

```{r students-per-day-summary, echo=FALSE}
students.per.day.long |>
  select(-Date, -Total) |>
  group_by(Attendance.Status) |>
  summarise(
    mean = mean(Count),
    median = median(Count),
    stdev = sd(Count),
    min = min(Count),
    range = max(Count) - min(Count),
    max = max(Count),
    skew = skewness(Count),
    kurt = kurtosis(Count)
  ) |>
  kbl(
    caption = "Ringkasan statistik kehadiran mahasiswa", 
    digits = 2,
  ) |>
  kable_material()
```

Tingkat kehadiran, keterlambatan, dan absen relatif imbang hari ke hari. Banyak mahasiswa secara keseluruhan per hari pun konsisten. Ini berarti tidak ada banyak hubungan antara status kehadiran dan risiko kesehatan dengan pergerakan hari ke hari.

### Tingkat kehadiran mahasiswa berdasarkan tingkat risiko kesehatan 

```{r attendance-by-risk, echo=FALSE}
attendance.by.risk <-
  new_data |>
  select(Student.ID, Risk.Level, Attendance.Status) |>
  group_by(Risk.Level, Attendance.Status) |>
  summarise(Count = n(), .groups = "drop")
attendance.by.risk.wide <- attendance.by.risk |>
  pivot_wider(names_from = Risk.Level, values_from = Count, values_fill = 0)

attendance.by.risk.wide |>
  kbl(
    caption = "Tabel kehadiran berdasarkan tingkat risiko",
    digits = 2,
  ) |>
  kable_material()
```

```{r attendance-by-risk-plot, echo=FALSE, fig.cap="Grafik per Risiko Kesehatan"}
attendance.by.risk.plot <- attendance.by.risk |>
  ggplot(aes(x = Risk.Level, y = Count, fill = Attendance.Status)) +
  # Use identity to avoid counting
  geom_bar(stat = "identity", position = position_dodge2(preserve = "single")) +
  labs(
    title = "Kehadiran per Risiko Kesehatan",
    x = "Tingkat Risiko",
    y = "Banyak Mahasiswa",
    fill = "Status Kehadiran",
  ) +
  scale_fill_brewer(palette = "Set1") # Optional: Chooses a color palette

# Display the plot
print(attendance.by.risk.plot)
```

Grafik di atas menunjukkan tingkat risiko kesehatan tinggi jika mahasiswa tidak hadir pada kuliah hari itu.

### Faktor-faktor yang mempengaruhi tingkat risiko kesehatan

```{r boxplots, echo=FALSE, fig.width=8, fig.height=7, fig.cap="Grafik Distribusi Atribut Numerik"}
box_class.duration <- ggplot(new_data, aes(x = Risk.Level, y = Class.Duration, fill = Risk.Level)) +
  geom_boxplot() +
  labs(title = "Class Duration") +
  rremove("x.text") + rremove("xlab") + rremove("ylab")

box_sleep.hours <- ggplot(new_data, aes(x = Risk.Level, y = Sleep.Hours, fill = Risk.Level)) +
  geom_boxplot() +
  labs(title = "Sleep Hour") +
  rremove("x.text") + rremove("xlab") + rremove("ylab")

box_stress.level <- ggplot(new_data, aes(x = Risk.Level, y = Stress.Level..GSR., fill = Risk.Level)) +
  geom_boxplot() +
  labs(title = "Stress Level (GSR)") +
  rremove("x.text") + rremove("xlab") + rremove("ylab")

box_anxiety.level <- ggplot(new_data, aes(x = Risk.Level, y = Anxiety.Level, fill = Risk.Level)) +
  geom_boxplot() +
  labs(title = "Anxiety Level") +
  rremove("x.text") + rremove("xlab") + rremove("ylab")

box_mood.score <- ggplot(new_data, aes(x = Risk.Level, y = Mood.Score, fill = Risk.Level)) +
  geom_boxplot() +
  labs(title = "Mood Score") +
  rremove("x.text") + rremove("xlab") + rremove("ylab")

box_class.start <- ggplot(new_data, aes(x = Risk.Level, y = Start.Hour, fill = Risk.Level)) +
  geom_boxplot() +
  labs(title = "Class Start Time") +
  rremove("x.text") + rremove("xlab") + rremove("ylab")

box_class.end <- ggplot(new_data, aes(x = Risk.Level, y = End.Hour, fill = Risk.Level)) +
  geom_boxplot() +
  labs(title = "Class End Time") +
  rremove("x.text") + rremove("xlab") + rremove("ylab")

boxes <- ggarrange(
  box_class.start, box_class.end, box_class.duration,
  box_sleep.hours, box_stress.level, box_anxiety.level,
  box_mood.score,
  ncol = 3, nrow = 3,
  common.legend = TRUE, legend = "bottom",
  align = "v"
)

annotate_figure(
  boxes,
  top = text_grob("Distribusi Atribut Numerik", size = 16),
)
```

```{r correlation-matrix, echo=FALSE}
correlations <- new_data |>
  mutate(
    .keep = "none",
    AS = Attendance.Status |> as.numeric(),
    CD = Class.Duration,
    SH = Start.Hour,
    EH = End.Hour,
    SL = Stress.Level..GSR.,
    AL = Anxiety.Level,
    MS = Mood.Score,
    SH = Sleep.Hours,
    RL = Risk.Level |> as.numeric()
    ) |>
  cor()

correlations |>
  kbl(digits = 2, caption = "Tabel Korelasi Antar Variabel", ) |>
  kable_material()
```

```{r correlation-matrix-plot, fig.height = 7, echo=FALSE}
corrplot(correlations,
  method = "color", addCoef.col = "black", addCoefasPercent = TRUE, 
  diag = FALSE,
)
```

Status kehadiran dan tingkat stres mahasiswa berperan besar terhadap tingginya risiko kesehatan mahasiswa. Sementara itu, tingkat kekhawatiran (_anxiety_) dan suasana hati (_mood_) juga berpengaruh, meskipun tidak sebesar sebelumnya. Atribut-atribut ini akan menentukan langkah yang diambil dalam pembelajaran mesin.

# Metodologi {#machine-learn}

## Model Pembelajaran Mesin

## Metrik Pengukuran Performa Model

## Persiapan data pelatihan

Untuk hasil yang konsisten dalam percobaan ini, digunakan seed tertentu untuk melakukan operasi.

```{r set-seed-1740812399}
# 1740812400 adalah 28 Februari 2025, 23:59:59 WIB
set.seed(1740812399)
```

Normalisasi data

```{r normalize-data}
new_data_just_numbers <- new_data |>
  mutate_all(as.numeric)
new_data_just_numbers$Risk.Level <- new_data$Risk.Level

normalized_data_values <- new_data_just_numbers |> 
  preProcess(method = c("center", "scale"))

normalized_data <- predict(normalized_data_values, new_data_just_numbers)
```

Pembentukan dua data:

1. Data yang mencakup semua variabel.
2. Data yang hanya melibatkan kolom-kolom yang berpengaruh terhadap tingkat risiko kesehatan.

```{r two-train-data}
numeric_data <- normalized_data

selected_data <- normalized_data |>
  select(
    Risk.Level,
    Attendance.Status,
    Stress.Level..GSR.,
    Anxiety.Level,
    Mood.Score
  )
```

Pembagian data ke dalam dua kelompok. Digunakan partisi yang sama untuk data lengkap dan data terpilih.

```{r train-index}
train_index <- createDataPartition(new_data$Risk.Level, p = 0.8, list = FALSE)
numeric_train_data <- numeric_data[train_index, ]
numeric_test_data <- numeric_data[-train_index, ]
selected_train_data <- selected_data[train_index, ]
selected_test_data <- selected_data[-train_index, ]
```

## Menentukan model

Untuk permasalahan klasifikasi seperti ini, tiga model akan diuji, yaitu Multinomial Logistic Regression, Random Forest, dan Support Vector Machines.

## Proses pelatihan

```{r logistics, cache=TRUE}
logit_model_numeric <- multinom(
  Risk.Level ~ .,
  data = numeric_train_data, trace = FALSE
)
logit_model_selected <- multinom(
  Risk.Level ~ .,
  data = selected_train_data, trace = FALSE
)
```

```{r rf, cache=TRUE}
rf_model_numeric <- randomForest(
  Risk.Level ~ .,
  data = numeric_train_data, 
  ntree = 5,
  mtry = 2
)

rf_model_selected <- randomForest(
  Risk.Level ~ .,
  data = selected_train_data, 
  ntree = 5,
  mtry = 2
)
```

```{r svm, cache=TRUE}
svm_model_numeric <- svm(
  Risk.Level ~ .,
  data = numeric_train_data, kernel = "radial"
)
svm_model_selected <- svm(
  Risk.Level ~ .,
  data = selected_train_data, kernel = "radial"
)
```

## Evaluasi model

Model dievaluasi dengan dua kriteria: akurasi dan lama prediksi.

```{r model-evaluation}
# Evaluate models with predictions
evaluate_model <- function(model, testData, model_name) {
  # Measure the time taken to make the predictions
  prediction_time <- system.time({
    predictions <- predict(model, newdata = testData)
  })['elapsed']  # Extract the elapsed time
  
  # Calculate the confusion matrix
  cm <- confusionMatrix(predictions, testData$Risk.Level)
  
  # Extract the accuracy
  accuracy <- cm$overall['Accuracy']
  
  # Return a list including the model name, accuracy, model object, and prediction time
  return(list(
    ModelName = model_name,
    Accuracy = accuracy,
    PredictionTime = prediction_time,
    ModelObject = model
  ))
}

# Initialize results data frame
results <- list(
  evaluate_model(
    logit_model_numeric, numeric_test_data, "MLR (All Fields)"
  ),
  evaluate_model(
    logit_model_selected, selected_test_data, "MLR (Selected Fields)"
  ),
  evaluate_model(
    rf_model_numeric, numeric_test_data, "RF (All Fields)"
  ),
  evaluate_model(
    rf_model_selected, selected_test_data, "RF (Selected Fields)"
  ),
  evaluate_model(
    svm_model_numeric, numeric_test_data, "SVM (All Fields)"
  ),
  evaluate_model(
    svm_model_selected, selected_test_data, "SVM (Selected Fields)"
  )
)
```

# Hasil dan Pembahasan {#results}

```{r calculate-results}
# Arcade-style million scoring multiplier
score_scale <- 1000000

# Convert results into a data frame for easier handling
results_df <- data.frame(
  Model = sapply(results, function(x) x$ModelName),
  Accuracy = sapply(results, function(x) x$Accuracy * score_scale),
  PredictionTime = sapply(results, function(x) x$PredictionTime * score_scale)
)

# Normalize accuracy and prediction time
results_df$NormAccuracy <-
  results_df$Accuracy / max(results_df$Accuracy) * score_scale
results_df$NormPredictionTime <-
  (max(results_df$PredictionTime) - (results_df$PredictionTime)) /
  (max(results_df$PredictionTime) - min(results_df$PredictionTime)) * 
  score_scale

# Combine the metrics
accuracy_weight <- 0.9
predictiontime_weight <- 0.1
results_df$CompositeScore <-
  (accuracy_weight * results_df$NormAccuracy) +
  (predictiontime_weight * results_df$NormPredictionTime)

# Print results
results_df |>
  kbl(digits = 0, caption = "Tabel Akurasi dan Waktu Prediksi Model") |>
  kable_material()
```

Untuk evaluasi, $R^2$ dan $RMSE$ tidak bisa digunakan untuk soal klasifikasi, karena lebih cocok untuk masalah regresi.

```{r visual-evaluation-accuracy}
# Visualize model accuracies
ggplot(results_df, aes(x = Model, y = Accuracy, fill = Model)) +
  geom_bar(stat = "identity", position = position_dodge()) +
  coord_cartesian(ylim = c(750000, 1000000)) +
  labs(title = "Akurasi Model", y = "Accuracy", x = "Model")
```

```{r visual-evaluation-prediction-time}
# TODO change to log scale
# Visualize model accuracies
ggplot(results_df, aes(x = Model, y = PredictionTime, fill = Model)) +
  geom_bar(stat = "identity", position = position_dodge()) +
  coord_cartesian(ylim = c(1e+03, 2e+06)) +
  scale_y_log10() +
  labs(title = "Waktu Prediksi Model", y = "Prediction Time", x = "Model")
```

```{r winner, echo=FALSE}
# Determine the best model
best_model_index <- which.max(results_df$CompositeScore)
best_model_name <- results_df$Model[best_model_index]
best_model_kind <- ((best_model_index - 1) %% 2) + 1
print(paste("Best Model:", best_model_name))
```

```{r winner-showcase, echo=FALSE}
# Retrieve the model object of the best model
best_model_object <- results[[best_model_index]]$ModelObject

test_data_kind_list <- list(numeric_test_data, selected_test_data)
test_data <- test_data_kind_list[[best_model_kind]]
# Visualize predictions of the best model
best_predictions <- predict(best_model_object, newdata = test_data)

# Print the confusion matrix for the best model
best_confusion_matrix <- confusionMatrix(best_predictions, test_data$Risk.Level)
```

```{r winner-confusion-matrix, fig.width=5, fig.height=5, echo=FALSE}
# https://developer.ibm.com/tutorials/awb-confusion-matrix-r/

best_confusion_matrix$table |> as.data.frame() |>
  ggplot(aes(x = Prediction, y = Reference, fill = Freq)) +
  geom_tile() + 
  theme_bw() +
  coord_equal() +
  scale_fill_distiller(palette = "Blues", direction = 1) +
  guides(fill = FALSE) +
  geom_text(aes(label = Freq), color = "black", size = 8) +
  # following lines only increase text size (optional)
  theme(axis.text.x = element_text(size = 16),
        axis.text.y = element_text(size = 16),
        axis.title.x = element_text(size = 24),
        axis.title.y = element_text(size = 24))
```

```{r winner-show-by-class, echo=FALSE}
best_confusion_matrix$byClass |>
  kbl(
    digits = 6, 
    caption = "Tabel Prediksi Per Tingkat Risiko", 
    col.names = c(
      "Sens",
      "Spec",
      "+ p-v",
      "- p-v",
      "Prec",
      "Recl",
      "F1",
      "Prev",
      "DetR",
      "DetP",
      "Accr"
    ),
  ) |>
  kable_material()
```

```{r winner-overall, echo=FALSE}
options(knitr.kable.NA = "N/A")
kbl(
  best_confusion_matrix$overall,
  caption = "Ringkasan Performa Model Terbaik",
) |>
  kable_material()
```


# Kesimpulan {#conclusion}

# Daftar Pustaka {#bibliography}

<div id="refs"></div>

# (APPENDIX) Lampiran {#appendix -} 

# Informasi Sesi R {#session-info}

```{r diagnostics}
sessionInfo()
```